on:
  push:
    branches:
      - stage

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: fifsky/ssh-action@master
        with:
          command: |
            cd /var/www/stage.vesta.org.ua/
            composer install
            wget --no-check-certificate --quiet --method GET --timeout=0 --header '' 'https://tsukr.tech/db_data_migrate.php'
            sed -i '17i Schema::disableForeignKeyConstraints();' /var/www/stage.vesta.org.ua/database/seeders/*
            php artisan migrate:fresh
            php artisan db:seed --force
            sudo chown -R www-data /var/www/stage.vesta.org.ua
          host: 31.131.17.142
          user: git
          key: ${{ secrets.GITKEY }}
